/*
 ==============================================================================
 PluginProcessor.h
 Author: Thomas Deppisch
 
 Copyright (c) 2019 - Austrian Audio GmbH
 www.austrian.audio
 
 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.
 
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
 
 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
 ==============================================================================
 */

#pragma once

#include "../JuceLibraryCode/JuceHeader.h"
#include <vector>
#include <memory> // for unique_ptr
#include <math.h>
#include <fftw3.h>

//==============================================================================
/**
*/
class PolarDesignerAudioProcessor  : public AudioProcessor, public AudioProcessorValueTreeState::Listener
{
public:
    //==============================================================================
    PolarDesignerAudioProcessor();
    ~PolarDesignerAudioProcessor();

    //==============================================================================
    void prepareToPlay (double sampleRate, int samplesPerBlock) override;
    void releaseResources() override;

   #ifndef JucePlugin_PreferredChannelConfigurations
    bool isBusesLayoutSupported (const BusesLayout& layouts) const override;
   #endif

    void processBlock (AudioBuffer<float>&, MidiBuffer&) override;

    //==============================================================================
    AudioProcessorEditor* createEditor() override;
    bool hasEditor() const override;

    //==============================================================================
    const String getName() const override;

    bool acceptsMidi() const override;
    bool producesMidi() const override;
    bool isMidiEffect() const override;
    double getTailLengthSeconds() const override;

    //==============================================================================
    int getNumPrograms() override;
    int getCurrentProgram() override;
    void setCurrentProgram (int index) override;
    const String getProgramName (int index) override;
    void changeProgramName (int index, const String& newName) override;

    //==============================================================================
    void getStateInformation (MemoryBlock& destData) override;
    void setStateInformation (const void* data, int sizeInBytes) override;
    
    //==============================================================================
    void parameterChanged (const String &parameterID, float newValue) override;
    
    //==============================================================================
    Result loadPreset (const File& presetFile);
    Result savePreset (File destination);
    File getLastDir() {return lastDir;}
    void setLastDir(File newLastDir);
    
    void startTracking(bool trackDisturber);
    void stopTracking(int applyOptimalPattern);
    
    int getNBands() {return nBands;}
    float getXoverSliderRangeStart (int sliderNum);
    float getXoverSliderRangeEnd (int sliderNum);
    Atomic<bool> repaintDEQ = true;
    Atomic<bool> nActiveBandsChanged = true;
    Atomic<bool> zeroDelayModeChanged = true;
    Atomic<bool> ffDfEqChanged = true;
    bool getDisturberRecorded() {return disturberRecorded;}
    bool getSignalRecorded() {return signalRecorded;}
    
    // initial xover frequencies for several numbers of bands
    const float INIT_XOVER_FREQS_2B[1] = {1000.0f};
    const float INIT_XOVER_FREQS_3B[2] = {250.0f,3000.0f};
    const float INIT_XOVER_FREQS_4B[3] = {200.0f,1000.0f,5000.0f};
    const float INIT_XOVER_FREQS_5B[4] = {150.0f,600.0f,2600.0f,8000.0f};
    
    // xover ranges for several numbers of bands
    const float XOVER_RANGE_START_2B[1] = {120.0f};
    const float XOVER_RANGE_END_2B[1] = {12000.0f};
    const float XOVER_RANGE_START_3B[2] = {120.0f, 2000.0f};
    const float XOVER_RANGE_END_3B[2] = {1000.0f, 12000.0f};
    const float XOVER_RANGE_START_4B[3] = {120.0f, 900.0f, 4000.0f};
    const float XOVER_RANGE_END_4B[3] = {450.0f, 2500.0f, 12000.0f};
    const float XOVER_RANGE_START_5B[4] = {120.0f, 500.0f, 2200.0f, 7000.0f};
    const float XOVER_RANGE_END_5B[4] = {200.0f, 1100.0f, 4000.0f, 12000.0f};
    
    int getEqState() {return doEq;}
    void setEqState(int idx) {doEq = idx;}
    float hzToZeroToOne(int idx, float hz);
    float hzFromZeroToOne(int idx, float val);
    bool zeroDelayModeActive() {return *zeroDelayMode != 0.0f;}
    
private:
    //==============================================================================
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (PolarDesignerAudioProcessor)
    
    int nBands;

    AudioProcessorValueTreeState params;
    static const int N_CH_IN = 2;
    
    // use odd FIR_LEN for even filter order (FIR_LEN = N+1)
    // (lowpass and highpass need even filter order to put a zero at f=0 and f=pi)
    static const int FIR_LEN = 401;
        
    // free field / diffuse field eq
    dsp::Convolution dfEqOmniConv;
    dsp::Convolution dfEqEightConv;
    AudioBuffer<float> dfEqOmniBuffer;
    AudioBuffer<float> dfEqEightBuffer;
    dsp::Convolution ffEqOmniConv;
    dsp::Convolution ffEqEightConv;
    AudioBuffer<float> ffEqOmniBuffer;
    AudioBuffer<float> ffEqEightBuffer;
    
    // proximity compensation filter
    dsp::ProcessorDuplicator<dsp::IIR::Filter<float>, dsp::IIR::Coefficients<float>> proxCompIIR;
    
    float* nBandsPtr;
    float* xOverFreqs[4];
    float* dirFactors[5];
    float oldDirFactors[5];
    float* bandGains[5];
    float oldBandGains[5];
    float* allowBackwardsPattern;
    int doEq;
    float* proxDistance;
    float oldProxDistance;
    float* zeroDelayMode;

    bool soloActive;
    float* soloBand[5];
    float* muteBand[5];
    bool loadingFile;
    bool trackingActive;
    bool trackingDisturber;
    bool disturberRecorded;
    bool signalRecorded;
    int nrBlocksRecorded;
    
    float omniSqSumDist[5], eightSqSumDist[5], omniEightSumDist[5],
          omniSqSumSig[5], eightSqSumSig[5], omniEightSumSig[5];
    
    AudioBuffer<float> filterBankBuffer; // holds filtered data, size: N_CH_IN*5
    AudioBuffer<float> firFilterBuffer; // holds filter coefficients, size: 5
    AudioBuffer<float> omniEightBuffer; // holds omni and fig-of-eight signals, size: 2
    std::vector<std::unique_ptr<dsp::Convolution>> convolvers; // holds nBands (stereo) convolvers
    
    double currentSampleRate;
    int currentBlockSize;
    
    //==============================================================================
    void resetXoverFreqs();
    void computeAllFilterCoefficients();
    void computeFilterCoefficients (int crossoverNr);
    void setProxCompCoefficients(float distance);
    void initAllConvolvers();
    void initConvolver(int convNr);
    void createOmniAndEightSignals (AudioBuffer<float>& buffer);
    void createPolarPatterns (AudioBuffer<float>& buffer);
    void trackSignalEnergy();
    void setMinimumDisturbancePattern();
    void setMaximumSignalPattern();
    void maximizeSigToDistRatio();
    
    // file handling
    File lastDir;
    ScopedPointer<PropertiesFile> properties;
    const String presetProperties[27] = {"nrActiveBands", "xOverF1", "xOverF2", "xOverF3", "xOverF4", "dirFactor1", "dirFactor2", "dirFactor3", "dirFactor4", "dirFactor5", "gain1", "gain2", "gain3", "gain4", "gain5", "solo1", "solo2", "solo3", "solo4", "solo5", "mute1", "mute2", "mute3", "mute4", "mute5","ffDfEq","proximity"};
    
    static const int DF_EQ_LEN = 1024;
    static const int FF_EQ_LEN = 1024;
    static const int EQ_SAMPLE_RATE = 48000;
};

static const float DFEQ_COEFFS_OMNI[1024] = {1.092629,0.014913,-0.296186,0.318594,0.012280,-0.075029,-0.200275,-0.066913,0.137369,0.061933,-0.031158,-0.002038,0.037064,0.000744,-0.052371,-0.025871,-0.008210,0.005882,-0.009821,-0.004457,-0.002916,0.002528,-0.006205,-0.011510,-0.010316,-0.004478,0.003435,0.008947,0.011657,0.008689,0.001945,-0.002909,-0.008674,-0.005933,-0.003344,0.004240,0.004840,0.005453,-0.000605,-0.004679,-0.008685,-0.007894,-0.004537,-0.000580,0.002294,0.002549,0.000584,-0.003128,-0.007224,-0.008998,-0.009326,-0.006393,-0.004901,-0.001972,-0.001660,-0.000220,-0.000920,-0.000326,-0.000393,0.000648,0.001468,0.002141,0.002377,0.001911,0.001274,0.000546,-0.000113,-0.000131,-0.000355,0.000393,0.000253,0.000967,0.000277,0.000338,-0.000784,-0.001111,-0.001971,-0.002147,-0.002365,-0.002311,-0.002189,-0.002169,-0.002117,-0.002151,-0.002190,-0.001960,-0.001882,-0.001260,-0.001144,-0.000431,-0.000499,0.000028,-0.000164,0.000207,0.000140,0.000466,0.000593,0.000809,0.000942,0.000953,0.000938,0.000816,0.000655,0.000569,0.000317,0.000337,-0.000005,0.000064,-0.000351,-0.000292,-0.000701,-0.000674,-0.000972,-0.000956,-0.001084,-0.001069,-0.001056,-0.001033,-0.000955,-0.000902,-0.000831,-0.000703,-0.000662,-0.000429,-0.000419,-0.000107,-0.000132,0.000187,0.000133,0.000380,0.000324,0.000474,0.000448,0.000508,0.000507,0.000487,0.000472,0.000408,0.000336,0.000277,0.000144,0.000119,-0.000070,-0.000022,-0.000219,-0.000151,-0.000350,-0.000284,-0.000418,-0.000383,-0.000451,-0.000435,-0.000425,-0.000402,-0.000344,-0.000315,-0.000266,-0.000190,-0.000148,-0.000047,-0.000068,0.000091,0.000057,0.000213,0.000140,0.000268,0.000213,0.000287,0.000231,0.000248,0.000217,0.000206,0.000185,0.000145,0.000101,0.000061,0.000014,0.000011,-0.000074,-0.000043,-0.000140,-0.000075,-0.000181,-0.000110,-0.000186,-0.000114,-0.000150,-0.000101,-0.000096,-0.000064,-0.000030,-0.000006,0.000034,0.000068,0.000094,0.000149,0.000143,0.000217,0.000176,0.000258,0.000195,0.000269,0.000202,0.000252,0.000196,0.000211,0.000171,0.000152,0.000123,0.000086,0.000060,0.000026,-0.000009,-0.000025,-0.000080,-0.000071,-0.000145,-0.000115,-0.000198,-0.000161,-0.000244,-0.000219,-0.000286,-0.000282,-0.000329,-0.000346,-0.000370,-0.000397,-0.000416,-0.000444,-0.000472,-0.000491,-0.000541,-0.000544,-0.000615,-0.000603,-0.000686,-0.000667,-0.000750,-0.000737,-0.000804,-0.000803,-0.000847,-0.000859,-0.000882,-0.000899,-0.000907,-0.000919,-0.000924,-0.000919,-0.000929,-0.000898,-0.000915,-0.000859,-0.000877,-0.000803,-0.000814,-0.000736,-0.000729,-0.000656,-0.000629,-0.000567,-0.000520,-0.000469,-0.000414,-0.000367,-0.000316,-0.000265,-0.000228,-0.000168,-0.000150,-0.000080,-0.000081,-0.000013,-0.000027,0.000030,0.000021,0.000071,0.000069,0.000100,0.000111,0.000126,0.000140,0.000144,0.000148,0.000150,0.000143,0.000153,0.000127,0.000150,0.000117,0.000141,0.000090,0.000115,0.000073,0.000088,0.000043,0.000042,0.000011,-0.000004,-0.000027,-0.000055,-0.000076,-0.000101,-0.000124,-0.000147,-0.000198,-0.000210,-0.000264,-0.000266,-0.000327,-0.000327,-0.000382,-0.000388,-0.000438,-0.000459,-0.000498,-0.000528,-0.000560,-0.000596,-0.000626,-0.000658,-0.000694,-0.000719,-0.000764,-0.000784,-0.000845,-0.000853,-0.000904,-0.000908,-0.000962,-0.000972,-0.001011,-0.001020,-0.001054,-0.001069,-0.001091,-0.001101,-0.001112,-0.001125,-0.001139,-0.001152,-0.001164,-0.001154,-0.001175,-0.001159,-0.001181,-0.001151,-0.001171,-0.001145,-0.001157,-0.001130,-0.001127,-0.001109,-0.001095,-0.001078,-0.001057,-0.001042,-0.001021,-0.000999,-0.000985,-0.000952,-0.000942,-0.000900,-0.000896,-0.000849,-0.000847,-0.000803,-0.000795,-0.000756,-0.000741,-0.000710,-0.000687,-0.000664,-0.000640,-0.000621,-0.000600,-0.000579,-0.000564,-0.000537,-0.000531,-0.000499,-0.000502,-0.000470,-0.000480,-0.000452,-0.000461,-0.000441,-0.000447,-0.000437,-0.000438,-0.000439,-0.000439,-0.000444,-0.000446,-0.000449,-0.000455,-0.000451,-0.000463,-0.000452,-0.000470,-0.000456,-0.000477,-0.000463,-0.000482,-0.000470,-0.000482,-0.000476,-0.000481,-0.000482,-0.000482,-0.000486,-0.000485,-0.000486,-0.000487,-0.000483,-0.000492,-0.000483,-0.000498,-0.000487,-0.000506,-0.000492,-0.000510,-0.000500,-0.000514,-0.000511,-0.000520,-0.000523,-0.000528,-0.000536,-0.000539,-0.000546,-0.000551,-0.000553,-0.000563,-0.000560,-0.000574,-0.000567,-0.000587,-0.000577,-0.000588,-0.000579,-0.000592,-0.000593,-0.000594,-0.000596,-0.000598,-0.000602,-0.000602,-0.000599,-0.000603,-0.000598,-0.000611,-0.000603,-0.000611,-0.000596,-0.000612,-0.000600,-0.000612,-0.000596,-0.000608,-0.000601,-0.000604,-0.000599,-0.000601,-0.000601,-0.000598,-0.000596,-0.000594,-0.000590,-0.000592,-0.000584,-0.000591,-0.000577,-0.000586,-0.000570,-0.000579,-0.000564,-0.000572,-0.000561,-0.000562,-0.000555,-0.000553,-0.000549,-0.000545,-0.000542,-0.000538,-0.000532,-0.000531,-0.000522,-0.000524,-0.000512,-0.000523,-0.000510,-0.000515,-0.000498,-0.000506,-0.000500,-0.000505,-0.000494,-0.000499,-0.000498,-0.000499,-0.000498,-0.000494,-0.000495,-0.000496,-0.000500,-0.000505,-0.000495,-0.000505,-0.000496,-0.000512,-0.000500,-0.000511,-0.000505,-0.000516,-0.000512,-0.000514,-0.000517,-0.000518,-0.000521,-0.000520,-0.000523,-0.000524,-0.000523,-0.000528,-0.000521,-0.000529,-0.000518,-0.000528,-0.000516,-0.000525,-0.000515,-0.000521,-0.000513,-0.000512,-0.000508,-0.000503,-0.000500,-0.000495,-0.000492,-0.000487,-0.000480,-0.000478,-0.000467,-0.000469,-0.000455,-0.000459,-0.000444,-0.000449,-0.000435,-0.000436,-0.000426,-0.000424,-0.000418,-0.000413,-0.000409,-0.000403,-0.000400,-0.000395,-0.000391,-0.000390,-0.000382,-0.000384,-0.000372,-0.000378,-0.000364,-0.000372,-0.000362,-0.000367,-0.000360,-0.000362,-0.000357,-0.000357,-0.000357,-0.000355,-0.000355,-0.000355,-0.000355,-0.000358,-0.000355,-0.000362,-0.000355,-0.000366,-0.000358,-0.000369,-0.000362,-0.000377,-0.000375,-0.000380,-0.000374,-0.000381,-0.000388,-0.000387,-0.000394,-0.000394,-0.000407,-0.000407,-0.000412,-0.000412,-0.000411,-0.000424,-0.000425,-0.000436,-0.000429,-0.000440,-0.000442,-0.000448,-0.000448,-0.000454,-0.000461,-0.000463,-0.000469,-0.000471,-0.000476,-0.000479,-0.000480,-0.000485,-0.000484,-0.000494,-0.000491,-0.000501,-0.000497,-0.000505,-0.000501,-0.000506,-0.000505,-0.000509,-0.000512,-0.000514,-0.000516,-0.000514,-0.000513,-0.000511,-0.000510,-0.000511,-0.000507,-0.000512,-0.000505,-0.000509,-0.000499,-0.000502,-0.000492,-0.000495,-0.000490,-0.000489,-0.000485,-0.000481,-0.000478,-0.000472,-0.000469,-0.000463,-0.000458,-0.000455,-0.000449,-0.000447,-0.000438,-0.000440,-0.000432,-0.000432,-0.000417,-0.000416,-0.000413,-0.000416,-0.000405,-0.000399,-0.000397,-0.000391,-0.000389,-0.000377,-0.000375,-0.000371,-0.000369,-0.000373,-0.000358,-0.000358,-0.000346,-0.000353,-0.000344,-0.000342,-0.000335,-0.000337,-0.000333,-0.000325,-0.000324,-0.000320,-0.000320,-0.000316,-0.000315,-0.000316,-0.000313,-0.000315,-0.000308,-0.000311,-0.000302,-0.000307,-0.000300,-0.000304,-0.000301,-0.000302,-0.000299,-0.000295,-0.000295,-0.000292,-0.000294,-0.000294,-0.000296,-0.000296,-0.000293,-0.000294,-0.000289,-0.000294,-0.000290,-0.000297,-0.000293,-0.000299,-0.000295,-0.000297,-0.000295,-0.000296,-0.000300,-0.000300,-0.000304,-0.000304,-0.000307,-0.000307,-0.000307,-0.000309,-0.000305,-0.000309,-0.000306,-0.000312,-0.000306,-0.000312,-0.000309,-0.000307,-0.000299,-0.000305,-0.000313,-0.000312,-0.000303,-0.000308,-0.000303,-0.000310,-0.000294,-0.000300,-0.000293,-0.000303,-0.000300,-0.000298,-0.000287,-0.000289,-0.000291,-0.000294,-0.000284,-0.000282,-0.000284,-0.000278,-0.000273,-0.000268,-0.000269,-0.000264,-0.000261,-0.000257,-0.000253,-0.000253,-0.000245,-0.000244,-0.000236,-0.000236,-0.000229,-0.000229,-0.000223,-0.000220,-0.000215,-0.000210,-0.000208,-0.000202,-0.000203,-0.000200,-0.000201,-0.000198,-0.000194,-0.000193,-0.000187,-0.000189,-0.000185,-0.000189,-0.000184,-0.000186,-0.000181,-0.000178,-0.000175,-0.000173,-0.000175,-0.000173,-0.000177,-0.000172,-0.000171,-0.000166,-0.000164,-0.000162,-0.000159,-0.000162,-0.000159,-0.000161,-0.000154,-0.000155,-0.000149,-0.000150,-0.000150,-0.000149,-0.000150,-0.000148,-0.000152,-0.000149,-0.000153,-0.000151,-0.000152,-0.000151,-0.000152,-0.000153,-0.000151,-0.000155,-0.000154,-0.000158,-0.000147,-0.000143,-0.000144,-0.000154,-0.000154,-0.000145,-0.000156,-0.000152,-0.000160,-0.000143,-0.000136,-0.000131,-0.000126,-0.000135,-0.000126,-0.000125,-0.000116,-0.000117,-0.000118,-0.000109,-0.000109,-0.000115,-0.000131,-0.000128,-0.000129,-0.000116,-0.000107,-0.000089,-0.000086,-0.000089,-0.000102,-0.000113,-0.000115,-0.000105,-0.000089,-0.000076,-0.000071,-0.000074,-0.000091,-0.000096,-0.000101,-0.000080,-0.000072,-0.000050,-0.000056,-0.000047,-0.000057,-0.000049,-0.000060,-0.000056,-0.000059,-0.000049,-0.000049,-0.000030,-0.000042,-0.000040,-0.000046,-0.000049,-0.000122,-0.000065,-0.000002,0.000055,-0.000077,-0.000014,-0.000059,0.000035,-0.000068,-0.000053,-0.000031,-0.000016,0.000050,-0.000038,-0.000041,-0.000090,0.000012,0.000046,0.000003,-0.000033,0.000016,0.000013,-0.000028,-0.000050,-0.000019,-0.000013,-0.000009,-0.000025,-0.000010,-0.000011,-0.000004,-0.000029,-0.000024,-0.000029,-0.000010,-0.000004,0.000009,0.000005,0.000001,-0.000013,-0.000021,-0.000024,-0.000014,-0.000002,0.000012,0.000008,0.000005,-0.000015,-0.000017,-0.000028,-0.000014,-0.000012,0.000005,0.000001,0.000002,-0.000010,-0.000018,-0.000027,-0.000030,-0.000027,-0.000024,-0.000022,-0.000019,-0.000021,-0.000016,-0.000022,-0.000015,-0.000024,-0.000017,-0.000023,-0.000009,-0.000009,0.000003,0.000005,0.000008,0.000003,-0.000008,-0.000015,-0.000020,-0.000011,0.000001,0.000011,0.000018,0.000010,0.000007,-0.000014,-0.000012,-0.000018,0.000004,0.000011,0.000029,0.000024,0.000014,0.000007,0.000000,0.000007,0.000006,0.000017,0.000016,0.000030,0.000037,0.000034,0.000041,0.000030,0.000040,0.000029,0.000053,0.000033,0.000063,0.000101,0.000093,0.000026,-0.000016,0.000053,0.000049,0.000050,0.000025,0.000031,0.000070,0.000036,0.000042,0.000011,0.000017,0.000036,0.000036,0.000036,0.000009,0.000009,0.000016,0.000013,0.000008,0.000007,0.000008,0.000006,0.000003,0.000002,0.000001,0.000000,0.000000};

static const float DFEQ_COEFFS_EIGHT[1024] = {1.235660,-0.110334,-0.271454,0.188401,-0.054367,0.187203,-0.115730,-0.037390,0.056718,0.013765,0.028173,-0.043536,-0.036279,0.008437,0.017978,0.039696,0.011301,0.003570,-0.025830,-0.005416,0.005961,0.021848,0.019303,0.005985,-0.010221,-0.022340,-0.021394,-0.015167,-0.003507,0.005418,0.007666,0.005263,-0.004002,-0.005772,-0.008333,-0.001083,-0.000161,0.004769,0.002289,0.002196,-0.001209,-0.002276,-0.002458,-0.001398,0.000991,0.002099,0.002932,0.002333,0.000983,0.000509,-0.000804,0.000436,-0.000526,0.001108,-0.000409,0.000480,-0.001249,-0.001067,-0.002360,-0.002414,-0.002658,-0.002601,-0.002298,-0.002428,-0.002249,-0.002342,-0.002448,-0.002211,-0.002603,-0.001951,-0.002543,-0.001637,-0.002277,-0.001337,-0.001835,-0.001107,-0.001399,-0.001056,-0.001146,-0.001132,-0.001099,-0.001274,-0.001251,-0.001392,-0.001491,-0.001456,-0.001781,-0.001545,-0.002056,-0.001655,-0.002230,-0.001802,-0.002360,-0.002093,-0.002540,-0.002470,-0.002697,-0.002740,-0.002752,-0.002821,-0.002733,-0.002743,-0.002691,-0.002575,-0.002652,-0.002387,-0.002598,-0.002215,-0.002500,-0.002086,-0.002365,-0.002026,-0.002225,-0.002021,-0.002094,-0.002025,-0.001997,-0.002019,-0.001963,-0.002007,-0.002014,-0.002022,-0.002154,-0.002081,-0.002332,-0.002175,-0.002496,-0.002304,-0.002620,-0.002446,-0.002686,-0.002583,-0.002714,-0.002696,-0.002724,-0.002757,-0.002729,-0.002763,-0.002749,-0.002737,-0.002786,-0.002688,-0.002808,-0.002623,-0.002797,-0.002592,-0.002768,-0.002577,-0.002699,-0.002571,-0.002634,-0.002599,-0.002605,-0.002633,-0.002600,-0.002641,-0.002637,-0.002652,-0.002703,-0.002658,-0.002777,-0.002672,-0.002839,-0.002709,-0.002876,-0.002742,-0.002873,-0.002782,-0.002870,-0.002832,-0.002854,-0.002852,-0.002831,-0.002838,-0.002826,-0.002824,-0.002834,-0.002787,-0.002836,-0.002745,-0.002844,-0.002719,-0.002839,-0.002712,-0.002821,-0.002727,-0.002806,-0.002763,-0.002796,-0.002798,-0.002797,-0.002822,-0.002816,-0.002837,-0.002855,-0.002844,-0.002900,-0.002843,-0.002932,-0.002840,-0.002947,-0.002847,-0.002946,-0.002860,-0.002920,-0.002864,-0.002880,-0.002857,-0.002839,-0.002835,-0.002804,-0.002796,-0.002778,-0.002744,-0.002756,-0.002686,-0.002731,-0.002632,-0.002697,-0.002585,-0.002641,-0.002534,-0.002559,-0.002476,-0.002465,-0.002411,-0.002367,-0.002331,-0.002273,-0.002235,-0.002182,-0.002121,-0.002091,-0.001999,-0.001997,-0.001880,-0.001898,-0.001771,-0.001795,-0.001679,-0.001687,-0.001597,-0.001581,-0.001523,-0.001489,-0.001461,-0.001422,-0.001409,-0.001386,-0.001370,-0.001377,-0.001348,-0.001394,-0.001354,-0.001431,-0.001388,-0.001478,-0.001448,-0.001535,-0.001532,-0.001603,-0.001632,-0.001685,-0.001737,-0.001780,-0.001841,-0.001886,-0.001935,-0.001992,-0.002017,-0.002093,-0.002093,-0.002182,-0.002163,-0.002251,-0.002223,-0.002296,-0.002281,-0.002335,-0.002341,-0.002371,-0.002387,-0.002393,-0.002410,-0.002411,-0.002420,-0.002430,-0.002416,-0.002439,-0.002397,-0.002432,-0.002376,-0.002418,-0.002349,-0.002383,-0.002320,-0.002338,-0.002289,-0.002276,-0.002239,-0.002207,-0.002179,-0.002144,-0.002117,-0.002084,-0.002045,-0.002029,-0.001971,-0.001969,-0.001890,-0.001896,-0.001817,-0.001821,-0.001748,-0.001734,-0.001669,-0.001632,-0.001585,-0.001540,-0.001503,-0.001453,-0.001410,-0.001363,-0.001307,-0.001277,-0.001210,-0.001199,-0.001120,-0.001113,-0.001038,-0.001031,-0.000961,-0.000947,-0.000888,-0.000868,-0.000828,-0.000797,-0.000766,-0.000732,-0.000703,-0.000677,-0.000652,-0.000638,-0.000604,-0.000603,-0.000561,-0.000583,-0.000536,-0.000561,-0.000520,-0.000542,-0.000517,-0.000533,-0.000529,-0.000534,-0.000541,-0.000541,-0.000553,-0.000559,-0.000570,-0.000589,-0.000591,-0.000623,-0.000613,-0.000655,-0.000638,-0.000686,-0.000673,-0.000717,-0.000714,-0.000746,-0.000754,-0.000774,-0.000793,-0.000806,-0.000830,-0.000844,-0.000863,-0.000884,-0.000892,-0.000923,-0.000917,-0.000956,-0.000942,-0.000982,-0.000966,-0.001000,-0.000987,-0.001009,-0.001004,-0.001011,-0.001014,-0.001011,-0.001016,-0.001010,-0.001011,-0.001010,-0.001001,-0.001010,-0.000990,-0.001008,-0.000980,-0.001002,-0.000973,-0.000993,-0.000970,-0.000982,-0.000969,-0.000971,-0.000968,-0.000963,-0.000964,-0.000957,-0.000958,-0.000956,-0.000950,-0.000958,-0.000943,-0.000959,-0.000935,-0.000955,-0.000929,-0.000949,-0.000929,-0.000942,-0.000929,-0.000931,-0.000925,-0.000919,-0.000920,-0.000913,-0.000914,-0.000910,-0.000902,-0.000904,-0.000890,-0.000900,-0.000881,-0.000897,-0.000873,-0.000886,-0.000870,-0.000877,-0.000868,-0.000865,-0.000860,-0.000857,-0.000856,-0.000849,-0.000846,-0.000843,-0.000832,-0.000841,-0.000824,-0.000838,-0.000812,-0.000828,-0.000806,-0.000823,-0.000801,-0.000813,-0.000796,-0.000802,-0.000795,-0.000795,-0.000792,-0.000786,-0.000783,-0.000779,-0.000775,-0.000779,-0.000770,-0.000780,-0.000762,-0.000776,-0.000754,-0.000771,-0.000753,-0.000770,-0.000757,-0.000764,-0.000755,-0.000754,-0.000753,-0.000752,-0.000756,-0.000756,-0.000755,-0.000757,-0.000750,-0.000760,-0.000748,-0.000765,-0.000750,-0.000764,-0.000751,-0.000767,-0.000756,-0.000767,-0.000756,-0.000764,-0.000764,-0.000765,-0.000768,-0.000766,-0.000768,-0.000767,-0.000769,-0.000775,-0.000768,-0.000779,-0.000763,-0.000785,-0.000767,-0.000785,-0.000770,-0.000781,-0.000775,-0.000780,-0.000783,-0.000782,-0.000786,-0.000782,-0.000784,-0.000784,-0.000784,-0.000792,-0.000786,-0.000799,-0.000786,-0.000803,-0.000789,-0.000807,-0.000797,-0.000812,-0.000809,-0.000816,-0.000817,-0.000819,-0.000825,-0.000825,-0.000832,-0.000836,-0.000839,-0.000848,-0.000844,-0.000857,-0.000848,-0.000865,-0.000853,-0.000871,-0.000861,-0.000874,-0.000868,-0.000875,-0.000874,-0.000874,-0.000877,-0.000875,-0.000878,-0.000877,-0.000877,-0.000880,-0.000873,-0.000880,-0.000866,-0.000878,-0.000862,-0.000875,-0.000859,-0.000867,-0.000854,-0.000855,-0.000848,-0.000846,-0.000844,-0.000839,-0.000835,-0.000827,-0.000820,-0.000816,-0.000807,-0.000810,-0.000793,-0.000799,-0.000777,-0.000783,-0.000763,-0.000771,-0.000751,-0.000752,-0.000738,-0.000735,-0.000731,-0.000716,-0.000715,-0.000700,-0.000700,-0.000688,-0.000685,-0.000675,-0.000665,-0.000663,-0.000649,-0.000655,-0.000634,-0.000636,-0.000622,-0.000622,-0.000614,-0.000608,-0.000601,-0.000591,-0.000588,-0.000580,-0.000579,-0.000574,-0.000567,-0.000565,-0.000554,-0.000557,-0.000544,-0.000550,-0.000536,-0.000542,-0.000529,-0.000531,-0.000523,-0.000522,-0.000519,-0.000516,-0.000516,-0.000510,-0.000510,-0.000507,-0.000505,-0.000507,-0.000502,-0.000508,-0.000499,-0.000507,-0.000496,-0.000505,-0.000498,-0.000506,-0.000501,-0.000503,-0.000501,-0.000498,-0.000500,-0.000499,-0.000504,-0.000504,-0.000503,-0.000503,-0.000500,-0.000505,-0.000500,-0.000510,-0.000502,-0.000509,-0.000500,-0.000510,-0.000503,-0.000510,-0.000503,-0.000503,-0.000508,-0.000504,-0.000510,-0.000504,-0.000506,-0.000503,-0.000504,-0.000509,-0.000502,-0.000511,-0.000496,-0.000511,-0.000501,-0.000508,-0.000501,-0.000501,-0.000501,-0.000499,-0.000504,-0.000500,-0.000502,-0.000496,-0.000494,-0.000492,-0.000488,-0.000492,-0.000485,-0.000491,-0.000480,-0.000486,-0.000474,-0.000479,-0.000472,-0.000474,-0.000472,-0.000470,-0.000470,-0.000464,-0.000464,-0.000459,-0.000459,-0.000455,-0.000452,-0.000453,-0.000445,-0.000450,-0.000439,-0.000444,-0.000432,-0.000435,-0.000427,-0.000430,-0.000427,-0.000425,-0.000423,-0.000414,-0.000411,-0.000403,-0.000404,-0.000402,-0.000402,-0.000401,-0.000392,-0.000392,-0.000384,-0.000390,-0.000383,-0.000389,-0.000379,-0.000378,-0.000375,-0.000375,-0.000374,-0.000372,-0.000362,-0.000373,-0.000364,-0.000373,-0.000360,-0.000369,-0.000356,-0.000370,-0.000360,-0.000371,-0.000362,-0.000362,-0.000364,-0.000369,-0.000367,-0.000367,-0.000366,-0.000367,-0.000375,-0.000375,-0.000381,-0.000378,-0.000379,-0.000380,-0.000382,-0.000390,-0.000388,-0.000396,-0.000389,-0.000396,-0.000391,-0.000399,-0.000399,-0.000406,-0.000409,-0.000410,-0.000413,-0.000409,-0.000413,-0.000410,-0.000415,-0.000415,-0.000417,-0.000420,-0.000417,-0.000422,-0.000415,-0.000421,-0.000416,-0.000422,-0.000419,-0.000422,-0.000422,-0.000420,-0.000422,-0.000417,-0.000421,-0.000416,-0.000419,-0.000417,-0.000418,-0.000420,-0.000418,-0.000421,-0.000414,-0.000418,-0.000411,-0.000416,-0.000413,-0.000417,-0.000416,-0.000413,-0.000411,-0.000403,-0.000406,-0.000401,-0.000407,-0.000403,-0.000404,-0.000397,-0.000394,-0.000394,-0.000390,-0.000394,-0.000387,-0.000388,-0.000378,-0.000384,-0.000380,-0.000382,-0.000381,-0.000367,-0.000380,-0.000367,-0.000376,-0.000367,-0.000372,-0.000372,-0.000374,-0.000381,-0.000371,-0.000376,-0.000360,-0.000367,-0.000376,-0.000377,-0.000383,-0.000371,-0.000374,-0.000364,-0.000372,-0.000366,-0.000374,-0.000369,-0.000373,-0.000372,-0.000375,-0.000374,-0.000370,-0.000365,-0.000361,-0.000367,-0.000380,-0.000386,-0.000386,-0.000364,-0.000355,-0.000335,-0.000351,-0.000361,-0.000402,-0.000403,-0.000404,-0.000370,-0.000363,-0.000357,-0.000394,-0.000411,-0.000408,-0.000383,-0.000371,-0.000348,-0.000382,-0.000383,-0.000415,-0.000362,-0.000401,-0.000332,-0.000480,-0.000332,-0.000421,-0.000331,-0.000409,-0.000393,-0.000408,-0.000394,-0.000353,-0.000390,-0.000339,-0.000462,-0.000360,-0.000384,-0.000359,-0.000396,-0.000415,-0.000402,-0.000366,-0.000358,-0.000348,-0.000375,-0.000388,-0.000402,-0.000365,-0.000359,-0.000334,-0.000360,-0.000370,-0.000402,-0.000395,-0.000394,-0.000367,-0.000351,-0.000336,-0.000342,-0.000353,-0.000364,-0.000361,-0.000354,-0.000338,-0.000336,-0.000326,-0.000337,-0.000331,-0.000346,-0.000332,-0.000337,-0.000315,-0.000315,-0.000304,-0.000309,-0.000311,-0.000314,-0.000314,-0.000305,-0.000296,-0.000287,-0.000282,-0.000286,-0.000285,-0.000296,-0.000287,-0.000294,-0.000273,-0.000276,-0.000260,-0.000269,-0.000265,-0.000274,-0.000273,-0.000270,-0.000266,-0.000256,-0.000256,-0.000248,-0.000250,-0.000249,-0.000249,-0.000258,-0.000250,-0.000254,-0.000227,-0.000230,-0.000216,-0.000240,-0.000247,-0.000269,-0.000272,-0.000258,-0.000237,-0.000202,-0.000205,-0.000210,-0.000242,-0.000251,-0.000249,-0.000219,-0.000189,-0.000211,-0.000203,-0.000243,-0.000223,-0.000229,-0.000181,-0.000187,-0.000186,-0.000178,-0.000201,-0.000120,-0.000154,-0.000150,-0.000141,-0.000143,-0.000101,-0.000110,-0.000086,-0.000102,-0.000083,-0.000083,-0.000065,-0.000044,-0.000058,-0.000043,-0.000039,-0.000028,-0.000019,-0.000018,-0.000014,-0.000011,-0.000007,-0.000004,-0.000001,-0.000000,-0.000000};

static const float FFEQ_COEFFS_OMNI[1024] = {0.965366,0.071102,0.125567,0.034545,-0.127998,-0.035655,-0.004315,-0.026729,-0.002800,-0.012468,-0.018556,0.013820,0.029382,0.021020,-0.001269,-0.033392,-0.050701,-0.033847,-0.003029,0.019988,0.018588,-0.001872,-0.023235,-0.025257,-0.006693,0.017588,0.031047,0.026450,0.010137,-0.005997,-0.012926,-0.010100,-0.003301,0.001301,0.001649,0.000864,0.001170,0.003311,0.004102,0.001933,-0.003085,-0.007578,-0.008869,-0.006466,-0.002635,-0.000592,-0.001680,-0.004937,-0.007734,-0.008100,-0.005880,-0.002440,0.000170,0.001075,0.000169,-0.001260,-0.002395,-0.002336,-0.001393,0.000101,0.001452,0.002364,0.002730,0.002635,0.002310,0.001866,0.001466,0.001134,0.000878,0.000718,0.000515,0.000295,-0.000159,-0.000712,-0.001453,-0.002077,-0.002568,-0.002719,-0.002639,-0.002387,-0.002123,-0.001949,-0.001860,-0.001837,-0.001777,-0.001639,-0.001400,-0.001063,-0.000719,-0.000357,-0.000095,0.000163,0.000344,0.000586,0.000809,0.001078,0.001289,0.001438,0.001476,0.001409,0.001271,0.001077,0.000873,0.000660,0.000450,0.000259,0.000070,-0.000077,-0.000237,-0.000355,-0.000506,-0.000617,-0.000747,-0.000822,-0.000883,-0.000892,-0.000872,-0.000819,-0.000739,-0.000648,-0.000533,-0.000405,-0.000253,-0.000079,0.000100,0.000295,0.000457,0.000620,0.000724,0.000820,0.000861,0.000898,0.000899,0.000896,0.000869,0.000826,0.000769,0.000694,0.000613,0.000524,0.000431,0.000332,0.000230,0.000142,0.000047,-0.000010,-0.000075,-0.000114,-0.000164,-0.000186,-0.000203,-0.000183,-0.000142,-0.000085,-0.000019,0.000048,0.000118,0.000188,0.000258,0.000326,0.000390,0.000453,0.000498,0.000556,0.000586,0.000614,0.000616,0.000620,0.000602,0.000590,0.000566,0.000532,0.000487,0.000440,0.000393,0.000347,0.000307,0.000264,0.000222,0.000190,0.000160,0.000151,0.000140,0.000147,0.000144,0.000160,0.000175,0.000208,0.000243,0.000284,0.000320,0.000354,0.000390,0.000427,0.000468,0.000506,0.000538,0.000563,0.000575,0.000589,0.000590,0.000597,0.000588,0.000583,0.000560,0.000539,0.000508,0.000478,0.000445,0.000410,0.000375,0.000337,0.000304,0.000271,0.000241,0.000214,0.000184,0.000162,0.000135,0.000118,0.000093,0.000076,0.000046,0.000022,-0.000009,-0.000037,-0.000068,-0.000099,-0.000130,-0.000163,-0.000196,-0.000233,-0.000274,-0.000315,-0.000360,-0.000402,-0.000448,-0.000486,-0.000530,-0.000564,-0.000604,-0.000635,-0.000669,-0.000696,-0.000722,-0.000743,-0.000757,-0.000767,-0.000770,-0.000768,-0.000760,-0.000746,-0.000727,-0.000700,-0.000671,-0.000632,-0.000594,-0.000546,-0.000500,-0.000445,-0.000393,-0.000335,-0.000278,-0.000219,-0.000160,-0.000102,-0.000045,0.000008,0.000059,0.000105,0.000147,0.000189,0.000224,0.000259,0.000284,0.000306,0.000320,0.000338,0.000353,0.000373,0.000390,0.000402,0.000409,0.000414,0.000418,0.000420,0.000424,0.000423,0.000418,0.000413,0.000404,0.000400,0.000393,0.000386,0.000371,0.000360,0.000342,0.000325,0.000303,0.000280,0.000251,0.000223,0.000196,0.000167,0.000139,0.000108,0.000078,0.000046,0.000011,-0.000022,-0.000058,-0.000089,-0.000123,-0.000154,-0.000192,-0.000229,-0.000271,-0.000311,-0.000349,-0.000385,-0.000420,-0.000458,-0.000498,-0.000540,-0.000580,-0.000619,-0.000656,-0.000690,-0.000729,-0.000761,-0.000794,-0.000823,-0.000852,-0.000877,-0.000904,-0.000927,-0.000946,-0.000963,-0.000980,-0.000994,-0.001007,-0.001019,-0.001027,-0.001035,-0.001042,-0.001043,-0.001043,-0.001038,-0.001035,-0.001028,-0.001024,-0.001015,-0.001004,-0.000987,-0.000970,-0.000950,-0.000932,-0.000916,-0.000897,-0.000875,-0.000851,-0.000825,-0.000800,-0.000774,-0.000752,-0.000727,-0.000703,-0.000676,-0.000652,-0.000625,-0.000601,-0.000576,-0.000552,-0.000528,-0.000504,-0.000481,-0.000459,-0.000438,-0.000418,-0.000397,-0.000378,-0.000359,-0.000345,-0.000330,-0.000320,-0.000309,-0.000301,-0.000292,-0.000287,-0.000282,-0.000280,-0.000280,-0.000281,-0.000284,-0.000288,-0.000292,-0.000295,-0.000299,-0.000302,-0.000305,-0.000309,-0.000312,-0.000317,-0.000319,-0.000323,-0.000323,-0.000325,-0.000325,-0.000326,-0.000328,-0.000329,-0.000330,-0.000331,-0.000332,-0.000333,-0.000334,-0.000334,-0.000334,-0.000337,-0.000339,-0.000344,-0.000347,-0.000353,-0.000354,-0.000358,-0.000362,-0.000369,-0.000377,-0.000385,-0.000392,-0.000396,-0.000402,-0.000407,-0.000415,-0.000423,-0.000429,-0.000434,-0.000439,-0.000444,-0.000448,-0.000454,-0.000457,-0.000459,-0.000461,-0.000465,-0.000469,-0.000471,-0.000474,-0.000475,-0.000476,-0.000479,-0.000481,-0.000483,-0.000483,-0.000486,-0.000488,-0.000489,-0.000489,-0.000490,-0.000488,-0.000490,-0.000490,-0.000491,-0.000491,-0.000490,-0.000487,-0.000487,-0.000488,-0.000489,-0.000489,-0.000487,-0.000482,-0.000479,-0.000477,-0.000477,-0.000475,-0.000474,-0.000468,-0.000463,-0.000458,-0.000457,-0.000457,-0.000457,-0.000453,-0.000447,-0.000442,-0.000437,-0.000435,-0.000433,-0.000429,-0.000425,-0.000421,-0.000418,-0.000415,-0.000416,-0.000414,-0.000410,-0.000408,-0.000406,-0.000404,-0.000407,-0.000407,-0.000406,-0.000405,-0.000406,-0.000407,-0.000408,-0.000411,-0.000411,-0.000413,-0.000418,-0.000419,-0.000421,-0.000423,-0.000425,-0.000426,-0.000431,-0.000434,-0.000437,-0.000438,-0.000439,-0.000440,-0.000442,-0.000447,-0.000451,-0.000453,-0.000453,-0.000452,-0.000451,-0.000451,-0.000452,-0.000452,-0.000452,-0.000449,-0.000447,-0.000444,-0.000442,-0.000440,-0.000437,-0.000434,-0.000429,-0.000425,-0.000421,-0.000416,-0.000411,-0.000405,-0.000399,-0.000393,-0.000389,-0.000383,-0.000379,-0.000373,-0.000369,-0.000363,-0.000358,-0.000354,-0.000350,-0.000346,-0.000341,-0.000338,-0.000333,-0.000328,-0.000324,-0.000320,-0.000317,-0.000315,-0.000313,-0.000309,-0.000306,-0.000303,-0.000302,-0.000302,-0.000302,-0.000301,-0.000298,-0.000295,-0.000293,-0.000294,-0.000297,-0.000299,-0.000301,-0.000301,-0.000301,-0.000302,-0.000307,-0.000310,-0.000314,-0.000317,-0.000320,-0.000322,-0.000328,-0.000332,-0.000336,-0.000339,-0.000343,-0.000349,-0.000354,-0.000361,-0.000365,-0.000369,-0.000373,-0.000379,-0.000384,-0.000388,-0.000395,-0.000400,-0.000405,-0.000412,-0.000417,-0.000420,-0.000424,-0.000430,-0.000437,-0.000445,-0.000450,-0.000454,-0.000455,-0.000458,-0.000462,-0.000468,-0.000475,-0.000479,-0.000483,-0.000486,-0.000489,-0.000492,-0.000497,-0.000500,-0.000503,-0.000505,-0.000506,-0.000508,-0.000510,-0.000511,-0.000511,-0.000511,-0.000511,-0.000510,-0.000510,-0.000510,-0.000509,-0.000507,-0.000503,-0.000499,-0.000495,-0.000492,-0.000491,-0.000491,-0.000490,-0.000486,-0.000480,-0.000475,-0.000470,-0.000467,-0.000465,-0.000462,-0.000457,-0.000452,-0.000447,-0.000442,-0.000440,-0.000437,-0.000432,-0.000427,-0.000423,-0.000418,-0.000417,-0.000413,-0.000407,-0.000402,-0.000397,-0.000393,-0.000389,-0.000387,-0.000382,-0.000376,-0.000374,-0.000369,-0.000364,-0.000360,-0.000356,-0.000353,-0.000352,-0.000350,-0.000347,-0.000343,-0.000338,-0.000334,-0.000332,-0.000333,-0.000335,-0.000336,-0.000333,-0.000329,-0.000326,-0.000324,-0.000325,-0.000326,-0.000327,-0.000326,-0.000324,-0.000321,-0.000320,-0.000319,-0.000319,-0.000320,-0.000320,-0.000320,-0.000320,-0.000321,-0.000322,-0.000321,-0.000321,-0.000320,-0.000321,-0.000325,-0.000329,-0.000331,-0.000331,-0.000329,-0.000327,-0.000328,-0.000334,-0.000341,-0.000346,-0.000348,-0.000345,-0.000343,-0.000344,-0.000348,-0.000352,-0.000354,-0.000353,-0.000351,-0.000351,-0.000353,-0.000356,-0.000356,-0.000356,-0.000355,-0.000354,-0.000358,-0.000359,-0.000356,-0.000355,-0.000352,-0.000352,-0.000352,-0.000354,-0.000351,-0.000350,-0.000351,-0.000349,-0.000347,-0.000346,-0.000343,-0.000342,-0.000343,-0.000341,-0.000338,-0.000333,-0.000327,-0.000322,-0.000323,-0.000323,-0.000322,-0.000318,-0.000311,-0.000305,-0.000302,-0.000302,-0.000300,-0.000298,-0.000292,-0.000285,-0.000279,-0.000276,-0.000274,-0.000274,-0.000273,-0.000270,-0.000269,-0.000267,-0.000264,-0.000262,-0.000260,-0.000258,-0.000257,-0.000258,-0.000258,-0.000258,-0.000256,-0.000253,-0.000251,-0.000250,-0.000251,-0.000252,-0.000252,-0.000251,-0.000249,-0.000247,-0.000244,-0.000242,-0.000240,-0.000239,-0.000238,-0.000240,-0.000239,-0.000238,-0.000234,-0.000231,-0.000229,-0.000231,-0.000236,-0.000239,-0.000240,-0.000237,-0.000233,-0.000232,-0.000235,-0.000239,-0.000243,-0.000243,-0.000242,-0.000243,-0.000244,-0.000249,-0.000253,-0.000251,-0.000248,-0.000245,-0.000243,-0.000247,-0.000252,-0.000249,-0.000245,-0.000240,-0.000234,-0.000229,-0.000229,-0.000229,-0.000228,-0.000234,-0.000236,-0.000231,-0.000222,-0.000213,-0.000206,-0.000209,-0.000220,-0.000227,-0.000227,-0.000218,-0.000208,-0.000203,-0.000207,-0.000216,-0.000220,-0.000218,-0.000212,-0.000208,-0.000207,-0.000203,-0.000191,-0.000178,-0.000174,-0.000187,-0.000213,-0.000234,-0.000231,-0.000199,-0.000157,-0.000133,-0.000145,-0.000178,-0.000201,-0.000193,-0.000160,-0.000131,-0.000132,-0.000157,-0.000184,-0.000197,-0.000184,-0.000159,-0.000158,-0.000157,-0.000160,-0.000170,-0.000143,-0.000119,-0.000158,-0.000159,-0.000168,-0.000166,-0.000151,-0.000126,-0.000145,-0.000167,-0.000141,-0.000151,-0.000151,-0.000140,-0.000147,-0.000140,-0.000117,-0.000117,-0.000128,-0.000154,-0.000186,-0.000192,-0.000165,-0.000132,-0.000117,-0.000132,-0.000165,-0.000186,-0.000173,-0.000139,-0.000108,-0.000103,-0.000124,-0.000157,-0.000178,-0.000179,-0.000167,-0.000154,-0.000150,-0.000151,-0.000150,-0.000143,-0.000139,-0.000142,-0.000154,-0.000168,-0.000173,-0.000169,-0.000159,-0.000155,-0.000158,-0.000169,-0.000178,-0.000179,-0.000175,-0.000170,-0.000169,-0.000174,-0.000179,-0.000180,-0.000177,-0.000173,-0.000171,-0.000174,-0.000178,-0.000181,-0.000179,-0.000174,-0.000167,-0.000165,-0.000166,-0.000170,-0.000172,-0.000172,-0.000169,-0.000166,-0.000167,-0.000168,-0.000169,-0.000167,-0.000165,-0.000167,-0.000177,-0.000191,-0.000196,-0.000185,-0.000157,-0.000127,-0.000111,-0.000123,-0.000158,-0.000191,-0.000199,-0.000175,-0.000142,-0.000120,-0.000126,-0.000152,-0.000170,-0.000160,-0.000133,-0.000107,-0.000090,-0.000097,-0.000111,-0.000108,-0.000098,-0.000095,-0.000080,-0.000085,-0.000104,-0.000080,-0.000061,-0.000055,-0.000046,-0.000047,-0.000051,-0.000050,-0.000032,-0.000029,-0.000029,-0.000020,-0.000018,-0.000015,-0.000011,-0.000011,-0.000010,-0.000008,-0.000005,-0.000002,-0.000001,-0.000000,-0.000000,-0.000000,-0.000000};

static const float FFEQ_COEFFS_EIGHT[1024] = {1.042240,-0.079619,-0.138413,-0.007452,0.186403,0.002565,-0.086606,0.019774,0.065049,0.010330,-0.024892,-0.021308,-0.011011,0.001275,0.018616,0.029516,0.024872,0.001967,-0.014949,-0.012988,0.005342,0.018823,0.020365,0.008721,-0.007375,-0.017828,-0.018192,-0.011022,-0.001963,0.005322,0.007505,0.004034,-0.002081,-0.006311,-0.006015,-0.003230,0.000331,0.002023,0.002442,0.001112,-0.000418,-0.001701,-0.001605,-0.000342,0.001400,0.002949,0.003648,0.003529,0.002743,0.001873,0.001343,0.001121,0.001280,0.001326,0.001451,0.001162,0.000829,0.000096,-0.000496,-0.001013,-0.001194,-0.001275,-0.001330,-0.001410,-0.001575,-0.001736,-0.001906,-0.001977,-0.001927,-0.001821,-0.001584,-0.001384,-0.001053,-0.000826,-0.000502,-0.000316,-0.000072,0.000048,0.000167,0.000192,0.000189,0.000170,0.000137,0.000125,0.000091,0.000050,-0.000010,-0.000106,-0.000181,-0.000311,-0.000387,-0.000548,-0.000665,-0.000879,-0.001041,-0.001253,-0.001403,-0.001547,-0.001634,-0.001683,-0.001706,-0.001696,-0.001682,-0.001648,-0.001604,-0.001558,-0.001487,-0.001440,-0.001349,-0.001303,-0.001208,-0.001169,-0.001088,-0.001054,-0.000993,-0.000960,-0.000917,-0.000888,-0.000872,-0.000864,-0.000881,-0.000912,-0.000961,-0.001027,-0.001091,-0.001180,-0.001245,-0.001343,-0.001401,-0.001491,-0.001540,-0.001615,-0.001656,-0.001708,-0.001737,-0.001760,-0.001777,-0.001782,-0.001788,-0.001785,-0.001777,-0.001762,-0.001741,-0.001724,-0.001681,-0.001669,-0.001631,-0.001611,-0.001561,-0.001545,-0.001515,-0.001506,-0.001500,-0.001496,-0.001493,-0.001496,-0.001512,-0.001521,-0.001534,-0.001556,-0.001584,-0.001613,-0.001624,-0.001662,-0.001677,-0.001702,-0.001707,-0.001736,-0.001747,-0.001769,-0.001778,-0.001783,-0.001777,-0.001777,-0.001782,-0.001778,-0.001774,-0.001766,-0.001758,-0.001754,-0.001741,-0.001741,-0.001728,-0.001732,-0.001718,-0.001724,-0.001720,-0.001732,-0.001733,-0.001741,-0.001747,-0.001753,-0.001764,-0.001776,-0.001791,-0.001804,-0.001816,-0.001829,-0.001834,-0.001848,-0.001851,-0.001866,-0.001864,-0.001875,-0.001869,-0.001871,-0.001862,-0.001858,-0.001847,-0.001836,-0.001824,-0.001808,-0.001793,-0.001774,-0.001755,-0.001736,-0.001712,-0.001694,-0.001668,-0.001649,-0.001615,-0.001591,-0.001551,-0.001520,-0.001480,-0.001444,-0.001403,-0.001362,-0.001321,-0.001277,-0.001233,-0.001187,-0.001141,-0.001095,-0.001047,-0.001004,-0.000955,-0.000916,-0.000867,-0.000831,-0.000785,-0.000751,-0.000711,-0.000680,-0.000647,-0.000620,-0.000597,-0.000577,-0.000561,-0.000549,-0.000541,-0.000537,-0.000537,-0.000546,-0.000553,-0.000572,-0.000588,-0.000616,-0.000638,-0.000674,-0.000705,-0.000745,-0.000784,-0.000827,-0.000871,-0.000916,-0.000962,-0.001006,-0.001051,-0.001094,-0.001135,-0.001178,-0.001214,-0.001254,-0.001283,-0.001315,-0.001337,-0.001368,-0.001391,-0.001419,-0.001441,-0.001461,-0.001475,-0.001487,-0.001499,-0.001509,-0.001519,-0.001524,-0.001526,-0.001527,-0.001521,-0.001518,-0.001513,-0.001508,-0.001491,-0.001483,-0.001467,-0.001453,-0.001430,-0.001410,-0.001385,-0.001361,-0.001339,-0.001313,-0.001284,-0.001257,-0.001231,-0.001202,-0.001167,-0.001138,-0.001104,-0.001075,-0.001042,-0.001014,-0.000975,-0.000939,-0.000898,-0.000860,-0.000823,-0.000788,-0.000751,-0.000708,-0.000666,-0.000623,-0.000579,-0.000538,-0.000498,-0.000461,-0.000414,-0.000376,-0.000336,-0.000299,-0.000258,-0.000223,-0.000188,-0.000157,-0.000126,-0.000097,-0.000064,-0.000037,-0.000014,0.000009,0.000030,0.000051,0.000069,0.000081,0.000094,0.000104,0.000115,0.000119,0.000126,0.000127,0.000127,0.000120,0.000116,0.000110,0.000103,0.000096,0.000085,0.000072,0.000056,0.000041,0.000026,0.000009,-0.000006,-0.000024,-0.000040,-0.000061,-0.000079,-0.000101,-0.000119,-0.000140,-0.000158,-0.000177,-0.000197,-0.000216,-0.000236,-0.000256,-0.000275,-0.000293,-0.000310,-0.000327,-0.000341,-0.000357,-0.000368,-0.000382,-0.000391,-0.000402,-0.000408,-0.000416,-0.000420,-0.000424,-0.000426,-0.000427,-0.000428,-0.000428,-0.000427,-0.000426,-0.000425,-0.000424,-0.000421,-0.000420,-0.000417,-0.000417,-0.000413,-0.000414,-0.000411,-0.000411,-0.000410,-0.000409,-0.000408,-0.000407,-0.000407,-0.000406,-0.000406,-0.000406,-0.000406,-0.000406,-0.000405,-0.000405,-0.000402,-0.000402,-0.000399,-0.000400,-0.000398,-0.000397,-0.000393,-0.000390,-0.000385,-0.000382,-0.000380,-0.000377,-0.000373,-0.000369,-0.000363,-0.000359,-0.000355,-0.000352,-0.000347,-0.000346,-0.000339,-0.000336,-0.000333,-0.000332,-0.000326,-0.000321,-0.000320,-0.000317,-0.000314,-0.000311,-0.000306,-0.000303,-0.000302,-0.000302,-0.000297,-0.000293,-0.000292,-0.000292,-0.000288,-0.000289,-0.000286,-0.000285,-0.000283,-0.000283,-0.000283,-0.000284,-0.000282,-0.000279,-0.000278,-0.000279,-0.000280,-0.000282,-0.000283,-0.000282,-0.000280,-0.000282,-0.000281,-0.000284,-0.000287,-0.000290,-0.000290,-0.000290,-0.000289,-0.000291,-0.000294,-0.000298,-0.000302,-0.000303,-0.000305,-0.000308,-0.000310,-0.000312,-0.000315,-0.000321,-0.000321,-0.000324,-0.000328,-0.000332,-0.000332,-0.000335,-0.000336,-0.000339,-0.000343,-0.000345,-0.000345,-0.000346,-0.000349,-0.000350,-0.000352,-0.000353,-0.000350,-0.000353,-0.000355,-0.000356,-0.000354,-0.000356,-0.000354,-0.000354,-0.000354,-0.000357,-0.000357,-0.000356,-0.000355,-0.000353,-0.000353,-0.000354,-0.000355,-0.000357,-0.000357,-0.000358,-0.000357,-0.000359,-0.000359,-0.000363,-0.000365,-0.000368,-0.000370,-0.000373,-0.000374,-0.000377,-0.000381,-0.000384,-0.000388,-0.000393,-0.000397,-0.000401,-0.000404,-0.000408,-0.000411,-0.000416,-0.000419,-0.000424,-0.000427,-0.000430,-0.000432,-0.000435,-0.000437,-0.000440,-0.000442,-0.000444,-0.000446,-0.000449,-0.000450,-0.000451,-0.000452,-0.000452,-0.000452,-0.000454,-0.000454,-0.000454,-0.000453,-0.000452,-0.000449,-0.000448,-0.000447,-0.000448,-0.000447,-0.000444,-0.000440,-0.000436,-0.000433,-0.000431,-0.000429,-0.000427,-0.000421,-0.000418,-0.000412,-0.000407,-0.000403,-0.000402,-0.000395,-0.000389,-0.000385,-0.000383,-0.000376,-0.000369,-0.000365,-0.000360,-0.000356,-0.000351,-0.000345,-0.000337,-0.000333,-0.000331,-0.000323,-0.000316,-0.000312,-0.000307,-0.000301,-0.000298,-0.000293,-0.000286,-0.000280,-0.000274,-0.000270,-0.000267,-0.000264,-0.000259,-0.000254,-0.000249,-0.000244,-0.000241,-0.000237,-0.000234,-0.000230,-0.000226,-0.000221,-0.000218,-0.000215,-0.000213,-0.000210,-0.000209,-0.000206,-0.000203,-0.000202,-0.000200,-0.000199,-0.000198,-0.000197,-0.000197,-0.000195,-0.000195,-0.000194,-0.000195,-0.000196,-0.000198,-0.000197,-0.000195,-0.000194,-0.000196,-0.000197,-0.000199,-0.000202,-0.000202,-0.000201,-0.000203,-0.000204,-0.000205,-0.000208,-0.000212,-0.000212,-0.000211,-0.000213,-0.000215,-0.000216,-0.000218,-0.000217,-0.000219,-0.000223,-0.000225,-0.000224,-0.000224,-0.000227,-0.000228,-0.000231,-0.000233,-0.000230,-0.000232,-0.000235,-0.000237,-0.000235,-0.000236,-0.000236,-0.000236,-0.000236,-0.000239,-0.000241,-0.000240,-0.000239,-0.000237,-0.000236,-0.000235,-0.000237,-0.000238,-0.000237,-0.000236,-0.000234,-0.000233,-0.000231,-0.000232,-0.000231,-0.000232,-0.000232,-0.000230,-0.000229,-0.000227,-0.000225,-0.000224,-0.000223,-0.000221,-0.000220,-0.000219,-0.000217,-0.000216,-0.000213,-0.000210,-0.000207,-0.000206,-0.000204,-0.000204,-0.000203,-0.000201,-0.000196,-0.000191,-0.000187,-0.000185,-0.000187,-0.000186,-0.000184,-0.000180,-0.000176,-0.000174,-0.000174,-0.000174,-0.000173,-0.000173,-0.000170,-0.000166,-0.000164,-0.000166,-0.000166,-0.000160,-0.000160,-0.000165,-0.000163,-0.000161,-0.000159,-0.000160,-0.000159,-0.000165,-0.000164,-0.000158,-0.000160,-0.000166,-0.000165,-0.000164,-0.000165,-0.000166,-0.000168,-0.000172,-0.000175,-0.000178,-0.000180,-0.000178,-0.000179,-0.000184,-0.000188,-0.000192,-0.000194,-0.000195,-0.000195,-0.000198,-0.000200,-0.000205,-0.000209,-0.000213,-0.000215,-0.000216,-0.000216,-0.000216,-0.000218,-0.000220,-0.000222,-0.000224,-0.000226,-0.000226,-0.000226,-0.000227,-0.000226,-0.000228,-0.000229,-0.000231,-0.000231,-0.000232,-0.000232,-0.000232,-0.000231,-0.000231,-0.000232,-0.000232,-0.000233,-0.000235,-0.000236,-0.000237,-0.000237,-0.000236,-0.000235,-0.000235,-0.000235,-0.000236,-0.000237,-0.000238,-0.000236,-0.000232,-0.000229,-0.000227,-0.000228,-0.000229,-0.000231,-0.000228,-0.000224,-0.000220,-0.000219,-0.000218,-0.000216,-0.000216,-0.000214,-0.000210,-0.000208,-0.000208,-0.000209,-0.000210,-0.000206,-0.000203,-0.000207,-0.000208,-0.000206,-0.000205,-0.000210,-0.000211,-0.000212,-0.000214,-0.000206,-0.000201,-0.000208,-0.000216,-0.000217,-0.000217,-0.000216,-0.000211,-0.000207,-0.000208,-0.000213,-0.000215,-0.000215,-0.000214,-0.000213,-0.000214,-0.000216,-0.000215,-0.000212,-0.000211,-0.000215,-0.000225,-0.000233,-0.000232,-0.000222,-0.000208,-0.000198,-0.000200,-0.000220,-0.000245,-0.000258,-0.000247,-0.000225,-0.000211,-0.000219,-0.000244,-0.000263,-0.000261,-0.000245,-0.000228,-0.000218,-0.000223,-0.000236,-0.000248,-0.000264,-0.000245,-0.000219,-0.000257,-0.000286,-0.000223,-0.000227,-0.000254,-0.000269,-0.000253,-0.000262,-0.000232,-0.000210,-0.000272,-0.000276,-0.000232,-0.000227,-0.000258,-0.000265,-0.000264,-0.000255,-0.000243,-0.000225,-0.000218,-0.000229,-0.000254,-0.000262,-0.000245,-0.000221,-0.000211,-0.000218,-0.000241,-0.000260,-0.000266,-0.000255,-0.000240,-0.000223,-0.000214,-0.000218,-0.000230,-0.000239,-0.000239,-0.000232,-0.000224,-0.000218,-0.000216,-0.000218,-0.000222,-0.000224,-0.000223,-0.000216,-0.000208,-0.000199,-0.000195,-0.000193,-0.000195,-0.000198,-0.000197,-0.000191,-0.000184,-0.000177,-0.000173,-0.000174,-0.000179,-0.000182,-0.000183,-0.000179,-0.000172,-0.000165,-0.000163,-0.000164,-0.000170,-0.000174,-0.000176,-0.000174,-0.000169,-0.000163,-0.000160,-0.000160,-0.000159,-0.000160,-0.000160,-0.000162,-0.000160,-0.000154,-0.000145,-0.000135,-0.000135,-0.000142,-0.000156,-0.000168,-0.000176,-0.000167,-0.000144,-0.000121,-0.000116,-0.000133,-0.000154,-0.000169,-0.000160,-0.000136,-0.000119,-0.000123,-0.000137,-0.000148,-0.000159,-0.000152,-0.000140,-0.000124,-0.000113,-0.000114,-0.000133,-0.000114,-0.000078,-0.000100,-0.000112,-0.000090,-0.000073,-0.000071,-0.000068,-0.000061,-0.000071,-0.000058,-0.000037,-0.000039,-0.000042,-0.000034,-0.000024,-0.000020,-0.000016,-0.000013,-0.000010,-0.000008,-0.000005,-0.000003,-0.000001,-0.000000,-0.000000};
